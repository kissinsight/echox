"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3474],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>u});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=c(n),g=r,u=d["".concat(p,".").concat(g)]||d[g]||m[g]||i;return n?a.createElement(u,l(l({ref:t},s),{},{components:n})):a.createElement(u,l({ref:t},s))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=g;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},9526:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={description:"Jaeager tracing middleware"},l="Jaeger",o={unversionedId:"middleware/jaeger",id:"middleware/jaeger",title:"Jaeger",description:"Jaeager tracing middleware",source:"@site/docs/middleware/jaeger.md",sourceDirName:"middleware",slug:"/middleware/jaeger",permalink:"/docs/middleware/jaeger",draft:!1,editUrl:"https://github.com/labstack/echox/blob/master/website/docs/middleware/jaeger.md",tags:[],version:"current",frontMatter:{description:"Jaeager tracing middleware"},sidebar:"docsSidebar",previous:{title:"Gzip",permalink:"/docs/middleware/gzip"},next:{title:"JWT",permalink:"/docs/middleware/jwt"}},p={},c=[{value:"Usage",id:"usage",level:2},{value:"Custom Configuration",id:"custom-configuration",level:2},{value:"Usage",id:"usage-1",level:3},{value:"Skipping URL(s)",id:"skipping-urls",level:3},{value:"TraceFunction",id:"tracefunction",level:3},{value:"CreateChildSpan",id:"createchildspan",level:3},{value:"References",id:"references",level:2}],s={toc:c},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"jaeger"},"Jaeger"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Echo community contribution")),(0,r.kt)("p",null,"Trace requests on Echo framework with Jaeger Tracing Middleware."),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package main\nimport (\n    "github.com/labstack/echo-contrib/jaegertracing"\n    "github.com/labstack/echo/v4"\n)\nfunc main() {\n    e := echo.New()\n    // Enable tracing middleware\n    c := jaegertracing.New(e, nil)\n    defer c.Close()\n\n    e.Logger.Fatal(e.Start(":1323"))\n}\n')),(0,r.kt)("p",null,"Enabling the tracing middleware creates a tracer and a root tracing span for every request."),(0,r.kt)("h2",{id:"custom-configuration"},"Custom Configuration"),(0,r.kt)("p",null,"By default, traces are sent to ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost")," Jaeger agent instance. To configure an external Jaeger, start your application with environment variables."),(0,r.kt)("h3",{id:"usage-1"},"Usage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ JAEGER_AGENT_HOST=192.168.1.10 JAEGER_AGENT_PORT=6831 ./myserver\n")),(0,r.kt)("p",null,"The tracer can be initialized with values coming from environment variables. None of the env vars are required\nand all of them can be overriden via direct setting of the property on the configuration object."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_SERVICE_NAME"),(0,r.kt)("td",{parentName:"tr",align:null},"The service name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_AGENT_HOST"),(0,r.kt)("td",{parentName:"tr",align:null},"The hostname for communicating with agent via UDP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_AGENT_PORT"),(0,r.kt)("td",{parentName:"tr",align:null},"The port for communicating with agent via UDP")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_ENDPOINT"),(0,r.kt)("td",{parentName:"tr",align:null},"The HTTP endpoint for sending spans directly to a collector, i.e. http://jaeger-collector:14268/api/traces")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_USER"),(0,r.kt)("td",{parentName:"tr",align:null},'Username to send as part of "Basic" authentication to the collector endpoint')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_PASSWORD"),(0,r.kt)("td",{parentName:"tr",align:null},'Password to send as part of "Basic" authentication to the collector endpoint')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_REPORTER_LOG_SPANS"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether the reporter should also log the spans")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_REPORTER_MAX_QUEUE_SIZE"),(0,r.kt)("td",{parentName:"tr",align:null},"The reporter's maximum queue size")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_REPORTER_FLUSH_INTERVAL"),(0,r.kt)("td",{parentName:"tr",align:null},'The reporter\'s flush interval, with units, e.g. "500ms" or "2s" (',"[valid units][timeunits]",")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_SAMPLER_TYPE"),(0,r.kt)("td",{parentName:"tr",align:null},"The sampler type")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_SAMPLER_PARAM"),(0,r.kt)("td",{parentName:"tr",align:null},"The sampler parameter (number)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_SAMPLER_MANAGER_HOST_PORT"),(0,r.kt)("td",{parentName:"tr",align:null},"The HTTP endpoint when using the remote sampler, i.e. http://jaeger-agent:5778/sampling")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_SAMPLER_MAX_OPERATIONS"),(0,r.kt)("td",{parentName:"tr",align:null},"The maximum number of operations that the sampler will keep track of")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_SAMPLER_REFRESH_INTERVAL"),(0,r.kt)("td",{parentName:"tr",align:null},'How often the remotely controlled sampler will poll jaeger-agent for the appropriate sampling strategy, with units, e.g. "1m" or "30s" (',"[valid units][timeunits]",")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_TAGS"),(0,r.kt)("td",{parentName:"tr",align:null},"A comma separated list of ",(0,r.kt)("inlineCode",{parentName:"td"},"name = value")," tracer level tags, which get added to all reported spans. The value can also refer to an environment variable using the format ",(0,r.kt)("inlineCode",{parentName:"td"},"${envVarName:default}"),", where the ",(0,r.kt)("inlineCode",{parentName:"td"},":default")," is optional, and identifies a value to be used if the environment variable cannot be found")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_DISABLED"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether the tracer is disabled or not. If true, the default ",(0,r.kt)("inlineCode",{parentName:"td"},"opentracing.NoopTracer")," is used.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"JAEGER_RPC_METRICS"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether to store RPC metrics")))),(0,r.kt)("p",null,"By default, the client sends traces via UDP to the agent at ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost:6831"),". Use ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_AGENT_HOST")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_AGENT_PORT")," to send UDP traces to a different ",(0,r.kt)("inlineCode",{parentName:"p"},"host:port"),". If ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_ENDPOINT")," is set, the client sends traces\nto the endpoint via ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP"),", making the ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_AGENT_HOST")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_AGENT_PORT")," unused. If ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_ENDPOINT")," is\nsecured, HTTP basic authentication can be performed by setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_USER")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"JAEGER_PASSWORD")," environment\nvariables."),(0,r.kt)("h3",{id:"skipping-urls"},"Skipping URL(s)"),(0,r.kt)("p",null,"A middleware skipper can be passed to avoid tracing spans to certain URL(s)."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Usage")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package main\nimport (\n    "strings"\n    "github.com/labstack/echo-contrib/jaegertracing"\n    "github.com/labstack/echo/v4"\n)\n\n// urlSkipper ignores metrics route on some middleware\nfunc urlSkipper(c echo.Context) bool {\n    if strings.HasPrefix(c.Path(), "/testurl") {\n        return true\n    }\n    return false\n}\n\nfunc main() {\n    e := echo.New()\n    // Enable tracing middleware\n    c := jaegertracing.New(e, urlSkipper)\n    defer c.Close()\n\n    e.Logger.Fatal(e.Start(":1323"))\n}\n')),(0,r.kt)("h3",{id:"tracefunction"},"TraceFunction"),(0,r.kt)("p",null,"This is a wrapper function that can be used to seamlessly add a span for\nthe duration of the invoked function. There is no need to change function arguments."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Usage")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package main\nimport (\n    "github.com/labstack/echo-contrib/jaegertracing"\n    "github.com/labstack/echo/v4"\n    "net/http"\n    "time"\n)\nfunc main() {\n    e := echo.New()\n    // Enable tracing middleware\n    c := jaegertracing.New(e, nil)\n    defer c.Close()\n    e.GET("/", func(c echo.Context) error {\n        // Wrap slowFunc on a new span to trace it\'s execution passing the function arguments\n        jaegertracing.TraceFunction(c, slowFunc, "Test String")\n        return c.String(http.StatusOK, "Hello, World!")\n    })\n    e.Logger.Fatal(e.Start(":1323"))\n}\n\n// A function to be wrapped. No need to change it\'s arguments due to tracing\nfunc slowFunc(s string) {\n    time.Sleep(200 * time.Millisecond)\n    return\n}\n')),(0,r.kt)("h3",{id:"createchildspan"},"CreateChildSpan"),(0,r.kt)("p",null,"For more control over the Span, the function ",(0,r.kt)("inlineCode",{parentName:"p"},"CreateChildSpan")," can be called\ngiving control on data to be appended to the span like log messages, baggages and tags."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Usage")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package main\nimport (\n    "github.com/labstack/echo-contrib/jaegertracing"\n    "github.com/labstack/echo/v4"\n)\nfunc main() {\n    e := echo.New()\n    // Enable tracing middleware\n    c := jaegertracing.New(e, nil)\n    defer c.Close()\n    e.GET("/", func(c echo.Context) error {\n        // Do something before creating the child span\n        time.Sleep(40 * time.Millisecond)\n        sp := jaegertracing.CreateChildSpan(c, "Child span for additional processing")\n        defer sp.Finish()\n        sp.LogEvent("Test log")\n        sp.SetBaggageItem("Test baggage", "baggage")\n        sp.SetTag("Test tag", "New Tag")\n        time.Sleep(100 * time.Millisecond)\n        return c.String(http.StatusOK, "Hello, World!")\n    })\n    e.Logger.Fatal(e.Start(":1323"))\n}\n')),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Opentracing Library: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/opentracing/opentracing-go"},"https://github.com/opentracing/opentracing-go")),(0,r.kt)("li",{parentName:"ul"},"Jaeger configuration: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/jaegertracing/jaeger-client-go#environment-variables"},"https://github.com/jaegertracing/jaeger-client-go#environment-variables"))))}m.isMDXComponent=!0}}]);